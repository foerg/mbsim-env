#! /bin/sh
# Unix sh variant of mbsimxml (mbsimxml.in)
# If editing this file, also edit the file mbsimxml.bat.in!

prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=${exec_prefix}/bin
datarootdir=@datarootdir@
datadir=@datadir@
MBSIMSCHEMA=@MBSIMSCHEMA@
MBSIMXMLSCHEMA=@MBSIMXMLSCHEMA@
MBXMLUTILSBINDIR=@MBXMLUTILSBINDIR@

# help
if [ $# -eq 0 -o "_$1" = "_-h" -o "_$1" = "_--help" ]; then
  echo "Usage: mbsimxml [--onlypreprocess]"
  echo "                [--mbsimparam <mbsimparameterfile>] <mbsimfile>"
  echo "                [--intparam <integratorparameterfile>] <integratorfile>"
  echo ""
  echo "Copyright (C) 2004-2009 MBSim Development Team"
  echo "This is free software; see the source for copying conditions. There is NO"
  echo "warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."
  echo ""
  echo "Licensed under the GNU Lesser General Public License (LGPL)"
  exit
fi

# parameters
ONLYPP="false"
if [ "_$1" = "_--onlypreprocess" ]; then
  ONLYPP="true"
  shift
fi
if [ "_$1" = "_--mbsimparam" ]; then
  PARAM=$2
  shift
  shift
else
  PARAM=none
fi
MBSIM=$1
PPMBSIM=.pp.$(basename $MBSIM)
shift
if [ "_$1" = "_--intparam" ]; then
  PARAMINT=$2
  shift
  shift
else
  PARAMINT=none
fi
MBSIMINT=$1
PPMBSIMINT=.pp.$(basename $MBSIMINT)

rm -f $PPMBSIM $PPMBSIMINT

$MBXMLUTILSBINDIR/mbxmlutilspp $PARAM $MBSIM $MBSIMXMLSCHEMA/mbsimxml.xsd $PARAMINT $MBSIMINT $MBSIMSCHEMA/mbsimintegrator.xsd || exit 1

if [ $ONLYPP = "false" ]; then
  $bindir/mbsimflatxml $PPMBSIM $PPMBSIMINT || exit 1
fi
