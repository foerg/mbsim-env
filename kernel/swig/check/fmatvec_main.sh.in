#!/bin/bash

set -e
set -o pipefail

# run this check only if MBSIM_SWIG is set (to avoid a long build time)
if test -z "$MBSIM_SWIG"; then
  exit 77 # = test SKIPPED
fi

SEP=":"
test "_@HOST_OS@" == "_mingw32" && SEP=";"

export LD_LIBRARY_PATH=@prefix@/bin:@prefix@/lib:$LD_LIBRARY_PATH
export PYTHONPATH=.${SEP}..${SEP}@abs_builddir@/.libs${SEP}@abs_builddir@/../.libs
# "script with  | cat > ..." is needed to avoid "Py_Initialize: can't initialize sys standard streams" when running with wine but fails on Linux :-(
rm -f result.txt
if [ "_@XC_EXEC_PREFIX@" == "_" ]; then
  @XC_EXEC_PREFIX@ @PYTHON_BIN@ @abs_srcdir@/fmatvec_main.py > result.txt
else
  script -qec "@XC_EXEC_PREFIX@ @PYTHON_BIN@ @abs_srcdir@/fmatvec_main.py | cat > result.txt" /dev/null
fi
cat result.txt
