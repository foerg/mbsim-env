<DynamicSystemSolver name="CrankMechanism" xmlns="http://mbsim.berlios.de/MBSim">
  <frames>
    <frame>
      <Frame name="I2">
        <enableOpenMBV> <!-- optional -->
          <size>fSize</size>
          <offset>1</offset>
        </enableOpenMBV>
      </Frame>
      <position>[l1 0 0]'</position>
      <orientation>eye(3)</orientation>
    </frame>
  </frames>
  <contours/>
  <groups>
    <embed href="controller.xml" count="1" counterName="X" xmlns="http://openmbv.berlios.de/MBXMLUtils/physicalvariable">
      <localParameter xmlns="http://openmbv.berlios.de/MBXMLUtils/physicalvariable">
        <parameter xmlns="http://openmbv.berlios.de/MBXMLUtils/parameter">
          <scalarParameter name="controllerKP">20.</scalarParameter>
          <scalarParameter name="controllerKI">100.</scalarParameter>
        </parameter>
      </localParameter>
    </embed>
  </groups>
  <objects>
    <RigidBody name="Crank" xmlns="http://mbsim.berlios.de/MBSim">
      <initialGeneralizedPosition>phi2InitPos</initialGeneralizedPosition> <!-- optional -->
      <initialGeneralizedVelocity>phi2InitVel</initialGeneralizedVelocity> <!-- optional -->
      <frameOfReference ref="../Frame[I]"/>
      <frameForKinematics ref="Frame[B2]"/>
      <mass>m2</mass>
      <inertiaTensor>J2*eye(3)</inertiaTensor>
      <generalTranslation/>
      <stateDependentRotation>
        <RotationAboutFixedAxis xmlns="http://mbsim.berlios.de/MBSim">
          <axisOfRotation>[0 0 1]'</axisOfRotation>
        </RotationAboutFixedAxis>
      </stateDependentRotation>
      <frames>
        <frame>
          <Frame name="B2">
            <enableOpenMBV> <!-- optional -->
              <size>fSize</size>
              <offset>1</offset>
            </enableOpenMBV>
          </Frame>
          <position>[-r2 0 0]'</position>
          <orientation>eye(3)</orientation>
        </frame>
      </frames>
      <contours>
        <contour>
          <CircleSolid name="crankBolt" xmlns="http://mbsim.berlios.de/MBSim">
            <radius>rBolt</radius>
            <!--<enableOpenMBV/> [> optional <]-->
          </CircleSolid>
          <frameOfReference ref="Frame[C]"/> <!-- optional -->
          <position>[l2-r2 0 0]'</position>
          <orientation>eye(3)</orientation>
        </contour>
      </contours>
      <openMBVRigidBody> <!-- optional -->
        <CompoundRigidBody name="XXX" xmlns="http://openmbv.berlios.de/OpenMBV">
          <staticColor>.2</staticColor> <!-- optional -->
          <initialTranslation>[0 0 0]'</initialTranslation>
          <initialRotation>[0 0 0]'</initialRotation>
          <scaleFactor>1.</scaleFactor>
          <Cuboid name="cuboid" xmlns="http://openmbv.berlios.de/OpenMBV">
            <initialTranslation>[l2/2-r2 0 -b/4-2e-4]'</initialTranslation>
            <initialRotation>[0 0 0]'</initialRotation>
            <scaleFactor>1.</scaleFactor>
            <length>[l2 b b/2]'</length>
          </Cuboid>
          <Frustum name="frustum" xmlns="http://openmbv.berlios.de/OpenMBV">
            <initialTranslation>[l2-r2 0 -b*0-1e-4]'</initialTranslation>
            <initialRotation>[0 0 0]'</initialRotation>
            <scaleFactor>1</scaleFactor>
            <baseRadius>rBolt</baseRadius>
            <topRadius>rBolt</topRadius>
            <height>b</height>
            <innerBaseRadius>0</innerBaseRadius>
            <innerTopRadius>0</innerTopRadius>
          </Frustum>
        </CompoundRigidBody>
      </openMBVRigidBody>
      <enableOpenMBVFrameC> <!-- optional -->
        <size>fSize</size>
        <offset>1</offset>
      </enableOpenMBVFrameC>
    </RigidBody>
    <RigidBody name="Rocker" xmlns="http://mbsim.berlios.de/MBSim">
      <initialGeneralizedPosition>phi4InitPos</initialGeneralizedPosition> <!-- optional -->
      <initialGeneralizedVelocity>phi4InitVel</initialGeneralizedVelocity> <!-- optional -->
      <frameOfReference ref="../Frame[I2]"/>
      <frameForKinematics ref="Frame[B4]"/>
      <mass>m4</mass>
      <inertiaTensor>J4*eye(3)</inertiaTensor>
      <generalTranslation/>
      <stateDependentRotation>
        <RotationAboutFixedAxis xmlns="http://mbsim.berlios.de/MBSim">
          <axisOfRotation>[0 0 1]'</axisOfRotation>
        </RotationAboutFixedAxis>
      </stateDependentRotation>
      <frames>
        <frame>
          <Frame name="B4">
            <enableOpenMBV> <!-- optional -->
              <size>fSize</size>
              <offset>1</offset>
            </enableOpenMBV>
          </Frame>
          <position>[-l4+r4 0 0]'</position>
          <orientation>eye(3)</orientation>
        </frame>
        <frame>
          <Frame name="T4">
            <enableOpenMBV> <!-- optional -->
              <size>fSize</size>
              <offset>1</offset>
            </enableOpenMBV>
          </Frame>
          <position>[r4 0 0]'</position>
          <orientation>eye(3)</orientation>
        </frame>
      </frames>
      <contours/>
      <openMBVRigidBody> <!-- optional -->
        <Cuboid name="XXX" xmlns="http://openmbv.berlios.de/OpenMBV">
          <staticColor>.6</staticColor> <!-- optional -->
          <initialTranslation>[-l4/2+r4 0 0]'</initialTranslation>
          <initialRotation>[0 0 0]'</initialRotation>
          <scaleFactor>1</scaleFactor>
          <length>[l4 b b]'</length>
        </Cuboid>
      </openMBVRigidBody>
      <enableOpenMBVFrameC> <!-- optional -->
        <size>fSize</size>
        <offset>1</offset>
      </enableOpenMBVFrameC>
    </RigidBody>
    <RigidBody name="Coupler" xmlns="http://mbsim.berlios.de/MBSim">
      <initialGeneralizedPosition>phi43InitPos</initialGeneralizedPosition> <!-- optional -->
      <initialGeneralizedVelocity>phi43InitVel</initialGeneralizedVelocity> <!-- optional -->
      <frameOfReference ref="../Object[Rocker]/Frame[T4]"/>
      <frameForKinematics ref="Frame[B3]"/>
      <mass>m3</mass>
      <inertiaTensor>J3*eye(3)</inertiaTensor>
      <generalTranslation/>
      <stateDependentRotation>
        <RotationAboutFixedAxis xmlns="http://mbsim.berlios.de/MBSim">
          <axisOfRotation>[0 0 1]'</axisOfRotation>
        </RotationAboutFixedAxis>
      </stateDependentRotation>
      <frames>
        <frame>
          <Frame name="B3">
            <enableOpenMBV> <!-- optional -->
              <size>fSize</size>
              <offset>1</offset>
            </enableOpenMBV>
          </Frame>
          <position>[-l3+r3 0 0]'</position>
          <orientation>eye(3)</orientation>
        </frame>
      </frames>
      <contours>
        <contour>
          <CircleHollow name="couplerBushing" xmlns="http://mbsim.berlios.de/MBSim">
            <radius>rBushing</radius>
            <!--<enableOpenMBV/> [> optional <]-->
          </CircleHollow>
          <frameOfReference ref="Frame[C]"/> <!-- optional -->
          <position>[r3 0 0]'</position>
          <orientation>eye(3)</orientation>
        </contour>
      </contours>
      <openMBVRigidBody> <!-- optional -->
        <CompoundRigidBody name="XXX" xmlns="http://openmbv.berlios.de/OpenMBV">
          <staticColor>.5</staticColor> <!-- optional -->
          <initialTranslation>[0 0 0]'</initialTranslation>
          <initialRotation>[0 0 0]'</initialRotation>
          <scaleFactor>1.</scaleFactor>
          <Cuboid name="cuboid" xmlns="http://openmbv.berlios.de/OpenMBV">
            <initialTranslation>[-l3/2+r3-rBushing/2 0 0]'</initialTranslation>
            <initialRotation>[0 0 0]'</initialRotation>
            <scaleFactor>1.</scaleFactor>
            <length>[l3-rBushing b b]'</length>
          </Cuboid>
          <Frustum name="frustum" xmlns="http://openmbv.berlios.de/OpenMBV">
            <initialTranslation>[r3 0 -b*0-1e-4]'</initialTranslation>
            <initialRotation>[0 0 0]'</initialRotation>
            <scaleFactor>1</scaleFactor>
            <baseRadius>rBushing+b/4</baseRadius>
            <topRadius>rBushing+b/4</topRadius>
            <height>b</height>
            <innerBaseRadius>rBushing</innerBaseRadius>
            <innerTopRadius>rBushing</innerTopRadius>
          </Frustum>
        </CompoundRigidBody>
      </openMBVRigidBody>
      <enableOpenMBVFrameC> <!-- optional -->
        <size>fSize</size>
        <offset>1</offset>
      </enableOpenMBVFrameC>
    </RigidBody>
  </objects>
  <links>
    <Contact name="jointContact" xmlns="http://mbsim.berlios.de/MBSim">
      <contactForceLaw>
        <UnilateralConstraint xmlns="http://mbsim.berlios.de/MBSim"></UnilateralConstraint>
      </contactForceLaw>
      <contactImpactLaw>
        <UnilateralNewtonImpact xmlns="http://mbsim.berlios.de/MBSim">
          <restitutionCoefficient>epsilon</restitutionCoefficient>
        </UnilateralNewtonImpact>
      </contactImpactLaw>
      <frictionForceLaw>
        <PlanarCoulombFriction xmlns="http://mbsim.berlios.de/MBSim">
          <frictionCoefficient>mu</frictionCoefficient>
        </PlanarCoulombFriction>
      </frictionForceLaw>
      <frictionImpactLaw>
        <PlanarCoulombImpact xmlns="http://mbsim.berlios.de/MBSim">
          <frictionCoefficient>mu</frictionCoefficient>
        </PlanarCoulombImpact>
      </frictionImpactLaw>
      <connect ref1="../Object[Coupler]/Contour[couplerBushing]" ref2="../Object[Crank]/Contour[crankBolt]"/>
      <enableOpenMBVContactPoints>fSize/4.</enableOpenMBVContactPoints> <!-- optional -->
      <openMBVNormalForceArrow> <!-- optional -->
        <Arrow name="XXX" xmlns="http://openmbv.berlios.de/OpenMBV">
          <minimalColorValue>0</minimalColorValue> <!-- optional -->
          <maximalColorValue>100</maximalColorValue> <!-- optional -->
          <diameter>arrowDiameter</diameter>
          <headDiameter>2*arrowDiameter</headDiameter>
          <headLength>2*arrowDiameter</headLength>
          <type>"toHead"</type>
          <scaleLength>.01</scaleLength>
        </Arrow>
      </openMBVNormalForceArrow>
      <openMBVFrictionArrow> <!-- optional -->
        <Arrow name="XXX" xmlns="http://openmbv.berlios.de/OpenMBV">
          <minimalColorValue>-10</minimalColorValue> <!-- optional -->
          <maximalColorValue>10</maximalColorValue> <!-- optional -->
          <diameter>arrowDiameter</diameter>
          <headDiameter>2*arrowDiameter</headDiameter>
          <headLength>2*arrowDiameter</headLength>
          <type>"toHead"</type>
          <scaleLength>.1</scaleLength>
        </Arrow>
      </openMBVFrictionArrow>
    </Contact>
  </links>
  <environments>
    <MBSimEnvironment xmlns="http://mbsim.berlios.de/MBSim">
      <accelerationOfGravity>[0 0 g]'</accelerationOfGravity>
    </MBSimEnvironment>
  </environments>
</DynamicSystemSolver>

